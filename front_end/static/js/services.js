// Generated by CoffeeScript 1.6.2
(function() {
  angular.module('episodeGet.services', []).service('userService', [
    '$rootScope', function($rootScope) {
      return {
        user: {
          id: 0,
          last_login: "",
          username: "游客",
          email: "",
          showUsername: function() {
            return this.username;
          }
        },
        updateUser: function(user) {
          this.user = user;
          return $rootScope.$broadcast('userService.update', this.user);
        }
      };
    }
  ]).service('infoListService', [
    '$rootScope', '$http', function($rootScope, $http) {
      return {
        infoList: {
          list: {
            an: angular.fromJson(localStorage.getItem('infoList_an')),
            ep: angular.fromJson(localStorage.getItem('infoList_ep'))
          },
          getList: function(sort) {
            var _this = this;

            if (!this.list[sort]) {
              return $http({
                method: 'GET',
                url: '/info/.json',
                params: {
                  nowplaying: 1,
                  sort: sort
                }
              }).success(function(data) {
                localStorage.setItem('infoList_' + sort, angular.toJson(data.results));
                _this.list[sort] = data.results;
                return _this.updateList(sort, data.results);
              });
            }
          },
          updateList: function(sort, list) {
            this.list[sort] = list;
            return $rootScope.$broadcast('infoListService.update', this.list);
          },
          sortInfo: function(info) {
            return -info.douban.average;
          }
        }
      };
    }
  ]);

}).call(this);
